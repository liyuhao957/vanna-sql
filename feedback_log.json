[
  {
    "question": "帮我查一下oppo手机2025年4月30号17:00:00-17:40:00点击过clickComplain的人，省份需要是广西的，要显示launchid、userid、qaOAIDMD5、model、packageName、sourcePackageName、省份、城市",
    "sql": "%%sql\nSELECT DISTINCT \n    e.launchId, \n    e.userId, \n    e.qaOAIDMD5, \n    i.model, \n    e.packageName, \n    i.sourcePackageName, \n    c.regionName, \n    c.cityName\nFROM ods_RealTime_pcc_quickapp_events e\nLEFT JOIN ods_RealTime_pcc_quickapp_events c\n    ON e.launchId = c.launchId\n    AND c.event = 'config'\n    AND c.timed = '2025-04-30'\nLEFT JOIN ods_RealTime_pcc_quickapp_events i\n    ON e.launchId = i.launchId\n    AND i.event = 'info'\n    AND i.timed = '2025-04-30'\nWHERE e.timed = '2025-04-30'\n    AND e.brand = 'oppo'\n    AND e.event = 'clickComplain'\n    AND c.regionName = '广西'\n    AND e.timedt BETWEEN '2025-04-30 17:00:00' AND '2025-04-30 17:40:00';",
    "type": "correct",
    "time": "2025-05-08T11:49:27.515043"
  },
  {
    "question": "统计今天华为好时光有多少个userid，并查询今天哪个userid下面的launchid最多（每个launchid代表进入了应用一次）",
    "sql": "%%sql\nWITH user_counts AS (\n    -- 统计今天华为好时光的用户总数\n    SELECT COUNT(DISTINCT userId) AS 用户总数\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND packageName = 'com.good.time'\n),\nlaunch_counts AS (\n    -- 查询每个用户的launchId数量，找出最多的\n    SELECT \n        userId AS 用户ID,\n        COUNT(DISTINCT launchId) AS 启动次数\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND packageName = 'com.good.time'\n        AND userId IS NOT NULL\n    GROUP BY userId\n    ORDER BY 启动次数 DESC\n    LIMIT 1\n)\nSELECT \n    uc.用户总数,\n    lc.用户ID AS launchId最多的用户,\n    lc.启动次数 AS 该用户的launchId次数\nFROM user_counts uc\nCROSS JOIN launch_counts lc;",
    "type": "incorrect",
    "time": "2025-05-09T11:07:36.599815"
  },
  {
    "question": "查找2025年5月9号11:00:00-5月9号11:15:00的人\n1. OPPO手机\n2. 省份是江苏\n3. 触发过clickComplain\n需要显示timedt 、launchid、usedrid、qaOAIDMD5、model、packageName、sourcePackageName、regionName、cityName，按时间倒序排序",
    "sql": "%%sql\nSELECT DISTINCT \n    e.timedt,\n    e.launchId, \n    e.userId, \n    e.qaOAIDMD5, \n    i.model, \n    e.packageName, \n    i.sourcePackageName, \n    c.regionName, \n    c.cityName\nFROM ods_RealTime_pcc_quickapp_events e\nLEFT JOIN ods_RealTime_pcc_quickapp_events c\n    ON e.launchId = c.launchId\n    AND c.event = 'config'\n    AND c.timed = '2025-05-09'\nLEFT JOIN ods_RealTime_pcc_quickapp_events i\n    ON e.launchId = i.launchId\n    AND i.event = 'info'\n    AND i.timed = '2025-05-09'\nWHERE e.timed = '2025-05-09'\n    AND e.brand = 'oppo'\n    AND e.event = 'clickComplain'\n    AND c.regionName = '江苏'\n    AND e.timedt BETWEEN '2025-05-09 11:00:00' AND '2025-05-09 11:15:00'\nORDER BY e.timedt DESC;",
    "type": "correct",
    "time": "2025-05-09T11:46:06.220571"
  },
  {
    "question": "我想查询今天VIVO的红莲剧场err占比，需要显示包名、brand、errcode、errmsg、人数（launchid）、占比（显示前10）",
    "sql": "%%sql\nSELECT \n    packageName AS 包名,\n    brand AS 品牌,\n    errCode AS 错误代码,\n    errMsg AS 错误信息,\n    COUNT(DISTINCT launchId) AS 人数,\n    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (PARTITION BY packageName, brand), 2) AS 占比\nFROM ods_RealTime_pcc_quickapp_events\nWHERE timed = CURRENT_DATE()\n    AND brand = 'vivo'\n    AND packageName = 'com.redlotus.theater'\n    AND event = 'err'\nGROUP BY packageName, brand, errCode, errMsg\nORDER BY 人数 DESC\nLIMIT 10;",
    "type": "correct",
    "time": "2025-05-09T12:19:27.328970"
  },
  {
    "question": "查找今天VIVO阳光阅读send2里的ggStatus in ('DOWNLOADED','DOWNLOADING','DOWNLOADFAILED','INSTALLFAILED')的人reqid相同的imp里的reqid like \"%layer_uni%\"，这个reqid 没有发生过clk后又有reqid like %reqid相同的imp里的reqid like \"%layer_uni%\"%，只需要显示3个launchid",
    "sql": "%%sql\nEXPLAIN\nWITH send2_filtered AS (\n    -- 筛选send2事件中ggStatus符合条件的记录\n    SELECT DISTINCT launchId, reqId\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'vivo'\n        AND packageName = 'com.sunshine.read'\n        AND event = 'send2'\n        AND ggStatus IN ('DOWNLOADED', 'DOWNLOADING', 'DOWNLOADFAILED', 'INSTALLFAILED')\n),\nimp_layer AS (\n    -- 筛选imp事件中reqId包含layer_uni的记录，并与send2_filtered关联\n    SELECT DISTINCT s.launchId, s.reqId\n    FROM send2_filtered s\n    JOIN ods_RealTime_pcc_quickapp_events imp\n        ON s.reqId = imp.reqId\n        AND imp.event = 'imp'\n        AND imp.timed = CURRENT_DATE()\n        AND imp.reqId LIKE '%layer_uni%'\n),\nno_clk AS (\n    -- 筛选没有clk事件的记录\n    SELECT il.launchId, il.reqId\n    FROM imp_layer il\n    LEFT JOIN ods_RealTime_pcc_quickapp_events clk\n        ON il.reqId = clk.reqId\n        AND clk.event = 'clk'\n        AND clk.timed = CURRENT_DATE()\n    WHERE clk.reqId IS NULL\n),\nsecond_imp_layer AS (\n    -- 筛选没有clk事件后再次出现imp事件且reqId包含layer_uni的记录\n    SELECT DISTINCT nc.launchId\n    FROM no_clk nc\n    JOIN ods_RealTime_pcc_quickapp_events imp2\n        ON nc.launchId = imp2.launchId\n        AND imp2.event = 'imp'\n        AND imp2.timed = CURRENT_DATE()\n        AND imp2.reqId LIKE '%layer_uni%'\n        AND imp2.timedt > (SELECT MIN(timedt) FROM ods_RealTime_pcc_quickapp_events WHERE reqId = nc.reqId AND event = 'imp' AND timed = CURRENT_DATE())\n    LIMIT 3\n)\nSELECT launchId\nFROM second_imp_layer;",
    "type": "correct",
    "time": "2025-05-13T15:37:33.345409"
  },
  {
    "question": "查询今天华为哪个产品launchid最多",
    "sql": "SELECT \n    packageName AS 产品,\n    COUNT(DISTINCT launchId) AS launchid数量\nFROM ods_RealTime_pcc_quickapp_events\nWHERE timed = CURRENT_DATE()\n    AND brand = 'huawei'\n    and event = 'info'\nGROUP BY packageName \nORDER BY launchid数量 DESC\nLIMIT 1;",
    "type": "incorrect",
    "time": "2025-05-13T18:07:50.271210"
  },
  {
    "question": "查询今天华为platformVersionCode=1121的机型和channelId分别占比",
    "sql": "%%sql\nEXPLAIN\nWITH total_count AS (\n    SELECT COUNT(*) AS total\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND platformVersionCode = 1121\n),\nmodel_stats AS (\n    SELECT \n        model,\n        COUNT(*) AS model_count,\n        ROUND(COUNT(*) * 100.0 / (SELECT total FROM total_count), 2) AS model_percentage\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND platformVersionCode = 1121\n    GROUP BY model\n),\nchannel_stats AS (\n    SELECT \n        channelId,\n        COUNT(*) AS channel_count,\n        ROUND(COUNT(*) * 100.0 / (SELECT total FROM total_count), 2) AS channel_percentage\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND platformVersionCode = 1121\n    GROUP BY channelId\n)\nSELECT \n    'Model' AS category,\n    model AS name,\n    model_count AS count,\n    model_percentage AS percentage\nFROM model_stats\nUNION ALL\nSELECT \n    'Channel' AS category,\n    channelId AS name,\n    channel_count AS count,\n    channel_percentage AS percentage\nFROM channel_stats\nORDER BY category, percentage DESC;",
    "type": "correct",
    "time": "2025-05-14T18:23:19.003742"
  },
  {
    "question": "查询今天华为每个platformVersionCode和platformVersionCode2的占比，需要把platformVersionCode2 is NULL的排除，并且需要把最新版本的那个显示在第一个，其他还是按比例排序，举例：如果有两个相同的platformVersionCode就比platformVersionCode2",
    "sql": "%%sql\nEXPLAIN\nWITH version_counts AS (\n    SELECT \n        platformVersionCode,\n        platformVersionCode2,\n        COUNT(*) AS version_count,\n        (COUNT(*) * 100.0) / SUM(COUNT(*)) OVER () AS percentage,\n        MAX(platformVersionCode2) OVER (PARTITION BY platformVersionCode) AS max_version2\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND platformVersionCode2 IS NOT NULL\n    GROUP BY platformVersionCode, platformVersionCode2\n),\nmax_version AS (\n    SELECT MAX(platformVersionCode) AS max_version_code\n    FROM version_counts\n)\nSELECT \n    platformVersionCode,\n    platformVersionCode2,\n    version_count,\n    ROUND(percentage, 2) AS percentage\nFROM version_counts\nCROSS JOIN max_version\nORDER BY \n    CASE \n        WHEN platformVersionCode = max_version_code\n        AND platformVersionCode2 = max_version2 \n        THEN 0 \n        ELSE 1 \n    END,\n    percentage DESC;",
    "type": "incorrect",
    "time": "2025-05-14T18:26:00.102188"
  },
  {
    "question": "我想查询今天华为设备上，各个平台版本组合（由 platformVersionCode 和 platformVersionCode2 决定）的事件数量统计和各自占比。请将整体最新的平台主版本号（platformVersionCode）及其对应的最新子版本号（platformVersionCode2）的那个特定组合优先显示在结果的第一位，其他的版本组合则按照事件数占比从高到低进行排序。最后，请展示排序后的前10条结果",
    "sql": "%%sql\nEXPLAIN\nWITH version_counts AS (\n    -- 统计每个平台版本组合的事件数量和占比\n    SELECT \n        platformVersionCode AS 主版本号,\n        platformVersionCode2 AS 子版本号,\n        COUNT(*) AS 事件数量,\n        ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) AS 占比\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND platformVersionCode IS NOT NULL\n        AND platformVersionCode2 IS NOT NULL\n    GROUP BY platformVersionCode, platformVersionCode2\n),\nmax_version AS (\n    -- 找出最新的主版本号及其对应的最新子版本号\n    SELECT \n        MAX(platformVersionCode) AS 最新主版本号,\n        MAX(platformVersionCode2) AS 最新子版本号\n    FROM ods_RealTime_pcc_quickapp_events\n    WHERE timed = CURRENT_DATE()\n        AND brand = 'huawei'\n        AND platformVersionCode IS NOT NULL\n        AND platformVersionCode2 IS NOT NULL\n)\nSELECT \n    vc.主版本号,\n    vc.子版本号,\n    vc.事件数量,\n    vc.占比\nFROM version_counts vc\nCROSS JOIN max_version mv\nORDER BY \n    CASE \n        WHEN vc.主版本号 = mv.最新主版本号\n        AND vc.子版本号 = mv.最新子版本号 \n        THEN 0 \n        ELSE 1 \n    END,\n    vc.占比 DESC\nLIMIT 10;",
    "type": "correct",
    "time": "2025-05-16T09:47:46.432812"
  }
]